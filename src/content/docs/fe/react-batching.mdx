---
layout: ../../../layouts/BlogPost.astro
title: UpdateBatching
---

### ğŸ“š Intro

setStateë¥¼ í˜¸ì¶œí•˜ë©´ ReactëŠ” ì¦‰ì‹œ ë¦¬ë Œë”ë§ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  í•´ë‹¹ ì—…ë°ì´íŠ¸ë¥¼ íì— ë“±ë¡í•œ í›„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ì‹¤í–‰ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.

ì´ ë¶€ë¶„ê³¼ batchingUpdateì´ë‘ ì—°ê´€ì´ ìˆë‹¤ê³  í•˜ëŠ”ë°
batchingUpdateì´ ë¬´ì—‡ì¸ì§€ ê·¸ë¦¬ê³  React 18ì— ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ê²ƒì´ ë¬´ì—‡ì¸ì§€
ë¬´ì§€ìƒíƒœì—ì„œ íŒŒí•´ì³ë³´ê¸°ë¡œ í•œë‹¤.

---

### Batching

stateëŠ” ê° ëœë”ë§ë§ˆë‹¤ ê³ ì •ë˜ì–´ìˆëŠ”ë° ë§Œì•½ stateê°€ ì—¬ëŸ¬ê°œ ë°”ë€Œë©´ ì–´ë–»ê²Œ ë ê¹Œ?
setNumber()ì™€ setName()ì´ëŸ° í•¨ìˆ˜ê°€ ì—¬ëŸ¬ë²ˆ ë‚˜ë‰˜ì–´ì„œ ì‹¤í–‰ë˜ë‚˜?

ì•„ë‹ˆë‹¤.
ë¶ˆí•„ìš”í•œ ëœë”ë§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ëª¨ë“  ì½”ë“œê°€ ì‹¤í–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.
ì¦‰, stateì˜ ì—…ë°ì´íŠ¸ ì‘ì—…ì„ ëª¨ì•„ ì¼ê´„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì„ Batchingì´ë¼ê³  í•œë‹¤.

```jsx
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);

  function increaseCount() {
    // ì•„ë˜ ì‘ì—…ë“¤ì€ ì¼ê´„ì‘ì—…ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.
    setCount((prev) => prev + 1);
    setCount((prev) => prev + 1);
    setCount((prev) => prev + 1);
  }

  return (
    <div>
      <button onClick={increaseCount}>+1</button>
      <p>Count : {count}</p>
    </div>
  );
}

export default Counter;
```

ReactëŠ” ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œëœ setStateë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ íì— ëª¨ì•„ë‘ê³  í•˜ë‚˜ì˜ ì¼ê´„ ì‘ì—…(batch)ìœ¼ë¡œ ì²˜ë¦¬í•´ ë‹¨ í•œ ë²ˆë§Œ ë¦¬ë Œë”ë§ì„ ë°œìƒì‹œí‚¨ë‹¤.

---

### React 18ì— ì¶”ê°€ëœ Automatic Batching

ê¸°ì¡´ì— batchingì€ ì–¸ì œ ìƒíƒœë¥¼ ë¬¶ì–´ì„œ ì²˜ë¦¬í•˜ëŠ”ì§€ ì¼ê´€ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ë¬¸ì œì ì´ ìˆì—ˆë‹¤.

```jsx
function App() {
  const [count, setCount] = useState(0);
  const [flag, setFlag] = useState(false);

  function handleClick() {
    fetchSomething().then(() => {
      // React 17 ì´í•˜ì—ì„œëŠ” batchingì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
      setCount((c) => c + 1); // ë¦¬ë Œë”ë§ ë°œìƒ
      setFlag((f) => !f); // ë˜ ë‹¤ì‹œ ë¦¬ë Œë”ë§ ë°œìƒ
    });
  }

  return (
    <div>
      <button onClick={handleClick}>Next</button>
      <h1 style={{ color: flag ? "blue" : "black" }}>{count}</h1>
    </div>
  );
}
```

ìœ„ì—ì²˜ëŸ¼ onClick ê°™ì€ React ì´ë²¤íŠ¸ í—¨ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œë§Œ batchê°€ ë°œìƒí–ˆë‹¤.
fetch, serTimeout, Promise ì½œë°± ë‚´ë¶€ì—ì„œëŠ” batchingì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

ë•Œë¬¸ì— ìœ„ì˜ ì½”ë“œì—ì„œ ë‘ë²ˆì˜ ë Œë”ë§ì´ ë°œìƒí•œë‹¤.

í•˜ì§€ë§Œ React 18 ì´ë£¨ë¶€í„°ëŠ” fetchë‚˜ serTimeoutì•ˆì—ì„œëŠ” ìƒíƒœ ì—…ë°ì´íŠ¸ë„ ìë™ batchingëœë‹¤.

React 18ì—ì„œëŠ” createRootë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ ë°°ì¹­ì´ ê¸°ë³¸ ì ìš©ëœë‹¤.
ReactDOM.render()ë°©ì‹ì€ ì—¬ì „íˆ 2ë²ˆì˜ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚œë‹¤.

#### legacy render

```jsx
import * as ReactDOM from "react-dom"; // ì˜› ë°©ì‹
// ...
const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);
```

#### create Root

```jsx
import * as ReactDOMClient from "react-dom/client"; // React 18 ë°©ì‹
// ...
const rootElement = document.getElementById("root");
const root = ReactDOMClient.createRoot(rootElement);
root.render(<App />);
```

---

### ì°¸ê³  ìë£Œ

- [Automatic batching for fewer renders in React 18](https://github.com/reactwg/react-18/discussions/21)
